---
title: "Claude Code v2.1.50 リリース - Worktreeフック追加・大規模メモリリーク修正・Opus 4.6が1Mコンテキスト対応"
description: "Anthropicは2026年2月21日（JST）、Claude Code v2.1.50をリリースした。WorktreeCreate/WorktreeRemoveフックの追加、エージェント定義でのworktreeアイソレーション宣言対応、SSHセッション切断時のデータ損失修正、glibc 2.30以前のLinuxでのネイティブモジュール読み込み不具合修正、長時間セッションを対象とした複数のメモリリーク修正、Opus 4.6（高速モード）への1Mコンテキスト対応拡大などが含まれる。"
publishedAt: "2026-02-21T09:30:00+09:00"
author: "AI Tools Hub"
category: "news"
lang: "ja"
tags: ["Claude Code", "Anthropic", "リリースノート", "バグ修正", "メモリ管理", "エージェント"]
featured: false
---

Anthropicは2026年2月20日（UTC）、Claude Code v2.1.50をnpmレジストリに公開した。前バージョンv2.1.49から約24時間でのリリースとなり、Worktreeフックの追加、エージェントチームのメモリ管理改善、Linux互換性修正、長時間セッションを対象とした複数のメモリリーク修正など、約26件の変更が含まれる。

## 主な変更点

### WorktreeCreate / WorktreeRemove フックの追加

エージェントのworktreeアイソレーション機能が作成・削除されるタイミングでカスタム処理を実行できる新フックイベント `WorktreeCreate` および `WorktreeRemove` が追加された。VCSのセットアップや後処理スクリプトをアイソレーション境界に合わせて実行できるようになる。

### エージェント定義でのworktreeアイソレーション宣言対応

エージェント定義ファイルに `isolation: worktree` を記述することで、そのエージェントが独立したgit worktreeで実行されるよう宣言的に指定できるようになった。従来は個別の設定や外部スクリプトで制御する必要があった。

### SSHセッション切断時のセッションデータ損失を修正

SSHが切断された際、グレースフルシャットダウンシーケンスにおいてフックおよびアナリティクスの前にセッションデータがフラッシュされるよう修正された。これにより、突然の切断が発生してもセッション履歴が保持されるようになる。

### symlink環境でのセッション再開不具合を修正

作業ディレクトリにsymlinkが含まれる場合、起動時のパス解決タイミングの差異により再開セッションが一覧に表示されないバグが修正された。

### Linux: glibc 2.30以前の環境でのネイティブモジュール読み込み不具合を修正

RHEL 8など、glibc 2.30より古いバージョンが搭載されたLinuxシステムでネイティブモジュールが読み込めなかった問題が修正された。企業環境での利用拡大が見込まれる。

### `claude agents` CLIコマンドの追加

設定済みのすべてのエージェントを一覧表示する `claude agents` コマンドが追加された。複数のエージェントを管理する開発者がエージェントの登録状況をターミナルから素早く確認できるようになる。

### CLAUDE_CODE_SIMPLE モードの機能絞り込み

`CLAUDE_CODE_SIMPLE` 環境変数によるシンプルモードが、MCPツール・添付ファイル・フック・CLAUDE.mdファイル読み込みも無効化するよう強化された。スキル、セッションメモリ、カスタムエージェント、CLAUDE.mdのトークンカウントも完全に除外される。トークンコストを最小限に抑えたい用途や、CIでの最小構成実行に適した設定となった。

### headlessモード起動パフォーマンスの改善

非インタラクティブモード（`-p` フラグ）起動時に、Yoga WASMおよびUIコンポーネントのインポートを遅延実行するよう変更された。スクリプトやCI/CDパイプラインでのコールドスタート時間が短縮される。

### Opus 4.6（高速モード）に1Mコンテキストウィンドウを追加

Opus 4.6の高速モードが100万トークンのコンテキストウィンドウに対応した。前バージョンではSonnet 4.6が1Mコンテキストに対応済みだったが、Opusシリーズへも展開された形となる。

また、新たに `CLAUDE_CODE_DISABLE_1M_CONTEXT` 環境変数が追加された。この変数を設定すると1Mコンテキストウィンドウのサポートを無効化できる。コスト管理や特定の環境制約に対応するための設定として機能する。

### VSCode: /extra-usage コマンドのサポート追加

VS Codeセッションで `/extra-usage` コマンドが利用可能になった。追加のトークン使用量情報をVS Code内から直接確認できるようになる。

### 長時間セッション向けメモリ管理の大幅改善

v2.1.50では、長時間稼働セッションのメモリ使用量を削減するための修正が集中的に実施された。

- エージェントチームで完了したタスクオブジェクトがAppStateから削除されずにメモリを占有し続けていた問題を修正
- LSP診断データが配信後もクリーンアップされず際限なく蓄積していたメモリリークを修正
- 完了タスクの出力データがメモリに保持されたままになっていた問題を修正
- TaskOutputの「最終行」バッファがクリーンアップ後も保持されていた問題を修正
- CircularBufferで削除済みアイテムがバッキング配列に残存していたメモリリークを修正
- シェルコマンド実行後にChildProcessおよびAbortControllerの参照が解放されなかった問題を修正
- コンパクション後に内部キャッシュを削除するよう改善
- ファイル履歴スナップショットの上限を設定し、無制限なメモリ増加を防止
- 処理済みのツール結果データをクリアするよう改善

### エージェントチームのメモリリークを修正

エージェントチーム実行時に、完了した各メンバータスクがセッションステートからガベージコレクションされずに残存する問題が修正された。多数のサブエージェントを組み合わせた長時間ワークフローでの安定性が向上する。

### その他の修正

- `/mcp reconnect` に存在しないサーバー名を渡したときCLIがフリーズする問題を修正
- MCP ツールサーチが有効な状態で起動引数にプロンプトを渡した際にMCPツールが認識されなかった不具合を修正
- プロンプトサジェストキャッシュのリグレッション修正（前バージョンに続いて追加修正）
- LSPサーバーの `startupTimeout` 設定のサポートを追加

## バージョン情報

- **バージョン**: 2.1.50
- **公開日**: 2026年2月21日（JST）
- **npm**: [@anthropic-ai/claude-code](https://www.npmjs.com/package/@anthropic-ai/claude-code)
- **インストール**: `npm install -g @anthropic-ai/claude-code`

## 関連リリース

v2.1.49からv2.1.50へのリリース間隔は約1日。メモリ管理の改善を中心に約26件の変更が含まれており、長時間稼働するエージェントワークフローの安定性向上に重点が置かれたリリースとなっている。
